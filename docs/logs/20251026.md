## October 26th, 2025

### Summary

The current **Origin–Destination (OD) computation** does not produce a truly real-time OD matrix, as the next check-in for a card often occurs **hours later**. This means our current approach effectively performs a **delayed OD inference** (i.e., *offline OD reconstruction*) rather than real-time estimation.

To address this, we plan to transition toward a **historical OD calculation** instead of real-time computation. This approach will allow us to incorporate **predictive models** (potentially with **online learning**) to continuously update OD estimates as new data becomes available.

The main open question is the **temporal granularity** of these historical OD matrices — whether it should match that used in $\hat{\lambda}$ estimates or differ. Additionally, we expect that if OD patterns vary over time, multiple OD entries may need to be stored per trip to capture temporal variation.

### Method and Implementation

1. **Algorithmic Adjustment**

   * The existing script `compute_realtime_od` has been **renamed to `compute_delayed_od`** to accurately reflect its functionality.
   * The script processes validation (check-in) events in chronological order but infers trips only after the next check-in occurs, leading to significant temporal delay.
   * The resulting OD matrix therefore represents **past travel behavior**, not the current state of the system.

2. **Shift to Historical OD Calculation**

   * The next step involves computing **historical OD matrices** using accumulated check-in data.
   * Each OD matrix will summarize inferred trips within a defined time interval (to be decided — e.g., 15 min, 1 hour, or 1 day).
   * Historical OD matrices could later be used as training data for **predictive OD models**, enabling **continuous updates** and **adaptive learning** as new data arrives.

3. **Granularity and Data Retention**

   * We must define the temporal **granularity** of the historical OD matrices:

     * Should it match the $\hat{\lambda}$ computation window (currently 15 minutes)?
     * Or should it aggregate over longer periods to smooth variability?
   * A flexible approach might store multiple OD entries per trip, reflecting changes in OD probabilities over time.

4. **Future Extensions**

   * Once historical OD computation is stable, we can explore **predictive modeling** approaches:

     * **Online learning** to update OD probabilities dynamically.
     * **Temporal segmentation** to handle day-of-week or seasonal variations.
   * These extensions would make the OD inference system semi-real-time by **predicting** the likely OD before the next check-in occurs.

### Decisions

1. The existing `compute_realtime_od` script was **renamed** to `compute_delayed_od` to correctly represent its offline inference nature.
2. We will **transition from real-time to historical OD computation** as the next development stage for OD.
3. Temporal **granularity of the historical OD matrices** remains to be defined and will be aligned with the needs of future predictive modeling.

### Assumptions to Validate

1. The **delayed OD inference** still provides meaningful estimates of passenger flows despite temporal lag.
2. Historical OD matrices can be effectively used to **train predictive models** for near-real-time estimation.
3. OD distributions $P(S_2 | S_1, t)$ evolve over time, requiring **multiple OD entries per trip**.
4. The optimal **granularity** (e.g., 15 min vs. 1 hour) will balance detail with computational efficiency.
5. Continuous or online learning methods can effectively adapt to evolving OD patterns.
