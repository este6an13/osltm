## November 1st, 2025

### Summary

Following a series of **non-homogeneous Poisson process (NHPP)** goodness-of-fit tests (using kernel, piecewise, and Kim & Whitt approaches), we observed **systematic rejection of the NHPP assumption** for two stations (U Nacional, Calle 100) and time segments—particularly during **peak hours**.

The evidence indicates that **check-in arrivals are overdispersed and clustered**, reflecting **bursty behavior linked to bus arrivals** rather than independent passenger arrivals. To capture this, we transitioned from a purely Poisson framework to a **Negative Binomial (NB) model**, which corresponds to a **Cox (doubly-stochastic Poisson) process** at the count level.

This shift allows the intensity to remain stochastic—accommodating variability caused by unobserved factors such as bus headways, passenger accumulation, and micro-level synchronization in tap-ins.

---

### Method and Implementation

1. **NHPP Validation and Failure Diagnosis**

   * Hourly NHPP tests using kernel and piecewise λ(t) estimates yielded **low p-values (< 0.05)** in most peak hours.
   * Applying **Kim & Whitt (2014)** tests (CU, Log, and Lewis) confirmed that:

     * NHPP holds approximately during **off-peak hours**.
     * NHPP fails during **peak hours**, consistent with **clustering and overdispersion**.
   * These patterns suggest that individual arrivals are **conditionally dependent**, likely driven by **bus-level events**.

2. **Negative Binomial Modeling**

   * Aggregated check-ins into **5-minute windows** and fit **Poisson vs. Negative Binomial (NB)** GLMs.
   * Example station (07107, U Nacional) showed:

     * Variance-to-mean ratio ≈ **56.5** → severe overdispersion.
     * **NB AIC (2275)** significantly lower than **Poisson AIC (2299)** → clear model improvement.
   * The NB model explains count variability via a random intensity term:
     $$
     \text{Var}(N_t) = \mu_t + \alpha \mu_t^2
     $$
     where **α** represents **overdispersion** (variance inflation relative to Poisson).

3. **Interpretation and Theoretical Connection**

   * The NB process corresponds to a **Gamma–Poisson mixture**, or equivalently, a **Cox process** where:
     $$
     N_t | \Lambda_t \sim \text{Poisson}(\Lambda_t), \quad \Lambda_t \sim \text{Gamma}(r, p)
     $$
   * Thus, arrivals remain Poisson **conditional on a latent, random intensity** Λₜ.
   * Estimated means (μₜ) serve as expected intensities, while α captures **unobserved variability** (bus arrivals, group behavior).

4. **Model Extensions Considered**

   | Extension                            | Purpose / Effect                                                                             |
   | ------------------------------------ | -------------------------------------------------------------------------------------------- |
   | **Generalized Additive Model (GAM)** | Nonparametric smoothing of μ(t) to capture daily patterns continuously.                      |
   | **Hierarchical / mixed NB**          | Introduce random effects for station or day type.                                            |
   | **Real-time updating**               | Incremental (SGD) or Bayesian online estimation for adaptive forecasts.                      |
   | **Simulation**                       | Use NB (Gamma–Poisson) to generate synthetic check-in streams for validation or forecasting. |

---

### Decisions

1. **Adopt the Negative Binomial framework** to model 5-minute check-in counts per station and day.
2. Treat this as a **Cox process**, with a random latent intensity Λₜ following a Gamma distribution.
3. Continue estimating and validating the **mean intensity μ(t)** — it remains interpretable as the expected check-in rate.
4. Introduce **day-type segmentation** (Weekday / Saturday / Sunday-Holiday) within the NB framework, as daily patterns remain distinct.

---

### Assumptions to Validate

1. Overdispersion in counts primarily reflects **bus-level clustering**, not timestamp rounding or data noise.
2. Treating Λₜ as **Gamma-distributed and independent across windows** adequately captures variability.
4. **Day-type segmentation** remains meaningful under NB/Cox modeling — i.e., weekday ≠ Saturday ≠ Sunday/Holiday.
5. Real-time estimation using incremental or Bayesian updates can approximate full re-fitting performance for short-term forecasting.
6. The **expected intensity μ(t)** estimated under NB remains interpretable and can serve as the core input for simulation and planning.
