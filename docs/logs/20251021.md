## October 21st, 2025

### Summary

We implemented a script named `generate_synthetic_data` that produces **synthetic validation (check-in) and exit (check-out) data** using the previously estimated arrival and departure rates stored in the database.
The script allows generating synthetic event-level data for a specific day, which can later be used for **simulation** or **validation** of the estimated rates.

Additionally, we created scripts for computing real-time/rolling $\lambda$ estimates both from **synthetic** and **real** data.W

### Method and Implementation

1. **Synthetic Data Generation**

   * Script: `generate_synthetic_data`
   * Input: a target date (e.g., `2025-10-14`).
   * Process:

     * Queries the database for all estimated $\lambda$ values corresponding to that date, based on:

       * **Month**, **week of the month**, **weekday**, and **station**.
     * Orders the results chronologically by the 5-minute interval labels (`600`, `615`, `630`, ...).
     * For each 5-minute interval and each station, generates **synthetic arrivals and departures** using a **Poisson distribution** with rate parameters from the stored estimates.
     * Assumes uniform distribution of arrivals/departures within the 5-minute window:

       ```python
       n_in = rng.poisson(e.estimated_lambda_in)
       offsets = rng.uniform(0, interval_minutes * 60, size=n_in)
       ```
     * The synthetic timestamps are created by adding these offsets to the start of the time window.

2. **Use Cases**

   * **Simulation:** synthetic data can be used to simulate system behavior in controlled conditions.
   * **Validation:** synthetic series can be compared against real future data to assess the accuracy of the estimated $\lambda$ values.
   * **Research continuity:** allows maintaining a fully functional pipeline (from estimation to online learning) assuming future availability of real-time event-level data for both arrivals and departures.

3. **Complementary Scripts**

   * `estimate_synthetic_lambda`:
     Reads the synthetic data and computes a **rolling $\lambda$ estimate** (based on the last 5 minutes) per station.
   * `estimate_lambda_in`:
     Performs the same estimation process but using **real check-in data**.


### Decisions

1. Introduce a **synthetic data generation layer** to:

   * Enable validation and testing of the $\lambda$ estimation pipeline without relying on new real data.
   * Create event-level data structures similar to what would exist in a real-time system: (time, station).

2. Maintain the same **time resolution (5 minutes)** for consistency with previous $\lambda$ estimates.

3. Use **Poisson sampling** as the baseline generation method, consistent with the NHPP assumption.


### Assumptions to Validate

1. <del>The number of arrivals and departures in each 5-minute window follows a **Poisson distribution** with mean equal to the estimated $\lambda$ for that interval.</del>
2. Arrivals and departures are **uniformly distributed** within each 5-minute window.
3. Synthetic data generated using these assumptions should **approximate real-world patterns** at the aggregate level (e.g., total arrivals per hour or per day).
4. <del>The $\lambda$ estimated from synthetic data (`estimate_synthetic_lambda`) should be **statistically consistent** with the original $\lambda$ estimates used for generation.</del>
5. Event timestamps generated using uniform offsets are a valid proxy for real passenger arrivals and exits.
