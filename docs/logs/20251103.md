## November 3rd, 2025

### Summary

Developed and integrated a **stratified date sampling utility** to generate representative subsets of days for downstream check-in/check-out analyses.
The script samples dates between **June 25, 2024** and **two days prior to the current date**, ensuring balanced coverage across **years, months, and day types** (weekday, weekend, holiday).

The sampled days can be directly used to download daily station-level datasets through a generated command-line call.
This reduces computational cost while preserving temporal diversity for exploratory and clustering analyses.

---

### Method and Implementation

* **Stratification approach:**
  Dates are partitioned by `(year, month, day_type)` where `day_type ∈ {"WD", "SA", "SU", "HO"}` (weekday, Saturday, Sunday, holiday).

  * Holidays override weekday/weekend classification.
  * Saturday and Sunday are treated separately within the grouping but combined for sampling to ensure sufficient weekend coverage.

* **Sampling process:**

  1. Each day in the date range is assigned to its `(year, month, day_type)` stratum via `get_day_type()` from `src.utils.day_type`.
  2. For each `(year, month)` combination, the script:

     * Samples up to `n_per_stratum` weekdays, weekends (combined SA+SU), and holidays (if any).
     * Falls back to weekday sampling if no weekends exist in a given month.
  3. Duplicates are removed and results sorted chronologically.

* **Implementation details:**

  * Function `sample_stratified_days()` handles the stratified sampling logic.
  * Function `generate_command()` produces a ready-to-run CLI command for batch downloading daily check-in and check-out data, specifying both input and output paths.
  * Uses a shared random seed (`SEED`) from `src.constants.seed` for reproducibility.
  * Prints the selected days and command when executed as a standalone script.

* **Default parameters:**

  ```python
  start = date(2024, 6, 25)
  end = datetime.now().date() - timedelta(days=2)
  n_per_stratum = 2
  random_seed = SEED
  ```

  This typically yields 5–7 samples per month depending on the presence of holidays.

---

### Decisions

1. **Range adjustment:**
   Updated the start date from May 2024 to **June 25, 2024** to align with available dataset completeness and consistent data coverage.

2. **Day-type codes:**
   Adopted short codes (`"WD"`, `"SA"`, `"SU"`, `"HO"`) to match internal conventions in `src.utils.day_type`.

3. **Weekend grouping:**
   Saturdays and Sundays are sampled together under a “weekend” category for balance, while maintaining separate codes for potential fine-grained analyses later.

4. **Holiday precedence:**
   Holidays take priority in classification, ensuring that long weekends and shifted holidays are correctly captured per Colombian regulations (Law 51 of 1983 – Ley Emiliani).

5. **CLI integration:**
   Added the `generate_command()` function to streamline downstream data retrieval, supporting direct reproducibility and automation.

6. **Reproducibility:**
   Fixed random seed via `SEED` constant for deterministic sampling across runs.

---

### Assumptions to Validate

1. **Temporal Representativeness:**
   Sampling two dates per month per category (weekday, weekend, holiday) is assumed sufficient to capture temporal variation.
   → *To validate:* compare sampled-day averages to full-month averages across a few key stations.

2. **Weekend Homogeneity:**
   Combining Saturday and Sunday into one weekend category assumes similar mobility patterns.
   → *To validate:* check if Saturday vs. Sunday demand differs significantly in temporal profiles.

3. **Holiday Sample Diversity:**
   Some months may have few or no holidays; the fallback ensures coverage but may underrepresent special days.
   → *To validate:* verify that the selected holidays include both fixed-date and movable holidays.

4. **Data Availability Lag:**
   The `end = today - 2 days` offset assumes data ingestion delays of up to 48 hours.
   → *To confirm:* ensure recent data availability matches this lag before integrating into automated workflows.
