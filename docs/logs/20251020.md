## October 20th, 2025

### Summary

We decided to model TransMilenio as a **queueing network**, where each station represents a queue of arrivals (check-ins) and departures.
Both arrivals and departures are modeled as **non-homogeneous Poisson processes (NHPP)** with **seasonal variation** (time of day, day of week, week of month, month, and year).
We implemented scripts to estimate per-station arrival and departure rates using **historical open data**, averaging over 5-minute windows.

### Method and Implementation

1. **Modeling Choice**

   * TransMilenio is modeled as a **network of queues**.
   * Each station corresponds to a queue with arrivals (check-ins) and departures.

2. **Arrival and Departure Processes**

   * Both processes follow a **non-homogeneous, seasonal Poisson process**, i.e., the rate $\lambda(t)$ varies throughout the day.
   * Example: higher $\lambda$ during rush hours, lower $\lambda$ during off-peak hours.

3. **Station-Specific and Temporal Behavior**

   * Each station $i$ has its own $\lambda(t)$.
   * The behavior varies by:

     * Day of the week
     * Week of the month
     * Month of the year
     * Holiday or non-holiday status
   * Behavior is expected to **repeat annually**, ignoring extreme events (e.g., pandemic lockdowns).
   * Example: all Mondays in the 3rd week of June should show similar patterns for the same station.

4. **Data and Scripts**

   * Data source: TransMilenio open data portal.
   * Historical datasets used:

     * **Daily validations (check-ins)**: one record per validation (time + station).
     * **Daily exits (check-outs)**: aggregated per machine every 15 minutes.

5. **Implementation Details**

   * Script `populate_daily_check_ins_estimates.py`:

     * Reads validation data.
     * Counts arrivals in **5-minute intervals** per station.
     * Groups data by station and sorts timestamps descending.
     * For each date (e.g., Oct 14, 2025 = Tuesday, week 3, month 10):
       $$
       t = (10, 3, \text{Tuesday}, \text{hour})
       $$
     * The 6:00â€“6:14 AM window is represented as `600`.
     * For station ( i ):
        $$
       x_{i,t,600}, x_{i,t,605},  x_{i,t,610}
        $$
       are the three 5-minute samples within the 15-min window.
     * Estimated mean arrival rate:
       $$
       \hat{\lambda}_{i,t,600} = \frac{x_{i,t,600} + x_{i,t,605} + x_{i,t,610}}{3}
       $$

   * Script `populate_daily_check_outs_estimates.py`:

     * Similar logic, but works with **aggregated 15-minute exit counts per machine**.
     * Values are summed per station and divided by 3 to estimate 5-minute rates.
     * Assumes a **uniform distribution of exits** within the 15-minute window.

### Decisions

1. The TransMilenio network is represented as a **queueing system**, where each station is a queue.
2. **Extreme events** (e.g., pandemics, strikes) are excluded from modeling.

### Assumptions to Validate

1. **Arrivals and departures follow a Non-Homogeneous Poisson Process (NHPP)** with time-varying rates.
2. The rate functions $\lambda(t)$ are **station-specific** and **seasonal**, varying by:

   * Time of day
   * Day of week
   * <del>Week of month</del>
   * Month
   * Holiday condition
3. Behavior **repeats yearly** (station-season pattern).
4. Departures per station are assumed to be **uniformly distributed** within each 15-minute window.
5. The average of three 5-minute windows is a valid estimator of the mean $\lambda$ for that 15-minute segment.
